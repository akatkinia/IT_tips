## Часто используемые команды
* ```docker run -it -p 8000:8443 python:alpine /bin/sh``` - запустить контейнер на основе базового образа python:alpine, пробросить порты и провалиться внутрь контейнера в оболочку /bin/sh
* ```docker port <CONTAINER_NAME>``` - посмотреть проброшенные порты в контейнере, где первый порт это порт на хостовой машине, а второй порт это порт внутри контейнера. Т.е., например 8000:8443 если обратиться к порту 8000 на хостовой машине, запрос будет перенаправлен на порт 8443 внутри контейнера.
* ```docker attach <CONTAINER_NAME>``` - подключить к уже запущенному контейнеру
* ```docker exec -it <CONTAINER_NAME> /bin/bash``` - зайти в контейнер в новой оболочке, либо исполнить команду
* ```docker rm $(docker ps -f status=exited -aq)``` - удалить все контейнеры со статусом exited
* ```docker rm $(docker ps -aq)``` - удалить все контейнеры
* ```docker rmi $(docker images -a -q)``` - удалить все образы
* ```docker system prune``` - очистить кэш слоев
* ```docker ps -a``` - показать все контейнеры, что запущены, либо были ранее запущены  
* ```docker build -t <CONTAINER_NAME> .``` - собрать образ из Dockerfile
  

## Монтирование  
Docker предоставляет два основных механизма для работы с файлами и данными между хост-системой и контейнерами: 
* **docker volumes (тома)** 
* **bind mounts (привязанные монтирования)**  
  
Они имеют различия в функциональности, использовании и характеристиках:
* **Docker Volumes (Тома):**  
  * Тома управляются Docker и хранятся в специальной части файловой системы Docker на хосте. Это означает, что они независимы от файловой системы хоста.
  * Тома могут быть совместно использованы между контейнерами, даже когда контейнеры запускаются на разных хостах в кластере Docker.
  * Docker позволяет более удобно управлять томами, например, переименовывать, удалять, создавать их заранее.
  * Тома могут иметь опции для шифрования данных в покое и т.д.
  * Используется с помощью ключевого слова volumes в Docker Compose или флага -v при запуске контейнера.
* **Bind Mounts (Привязанные монтирования):**
  * Привязанные монтирования монтируют прямо существующие пути с хост-системы в контейнер. Это означает, что они полностью зависят от файловой системы хоста.
  * Привязанные монтирования подходят для сценариев, где вы хотите, чтобы изменения в файлах контейнера сразу же отражались в файлах на хосте и наоборот.
  * Они позволяют более прямое управление над местоположением данных на хосте
  * Используется с помощью флага -v при запуске контейнера или секции volumes в Docker Compose.
  
### VOLUMES
**Тома (Volumes)** - внешнее хранилище. Тома могут быть расположены на docker-хосте или даже на удалённой машине.  
Когда контейнер умирает, все данные, которые он создал (журналы, БД и тд) умирают вместе с ним. Чтобы избежать потери данных, следует использовать тома.  
Тома можно монтировать в режиме только для чтения.  
```--volume``` - создать файл или каталог, если он не находится в docker host
```--mount``` - не создаёт его автоматически, но генерирует ошибку  
  
#### Примеры команд:
* ```docker volume create <VOLUME_NAME>``` - создать том
* ```docker volume rm <VOLUME_NAME>``` - удалить том
* ```docker volume prune``` - удалить неиспользуемые тома
* ```docker volume inspect <VOLUME_NAME>``` - посмотреть том
* ```run -it -v my-volume:/data --name my-container selaworkshop/busybox:latest``` - запуск контейнера в интерактивном режиме и подключает volume my-volume (создаёт если его нет, либо использует существующий если он есть) в директорию /data, монтируя его с docker-host (как правило находится по пути /var/lib/docker/volumes/ на Linux)  
  
### BIND MOUNTS

___

## Отправить образ в удалённый репозиторий
1. Войти в наш репозиторий ```docker login <registry hub>``` (по умолчанию удалённый репозиторий используется как dockerhub)
2. Тегирование образа. Когда образ создан, ему нужно присвоить тег, который будет идентифицировать версию или какую-либо метку образа. Обычно это делается с помощью команды docker tag следующим образом: ```docker tag <имя_образа>:<текущий_тег> <имя_репозитория>:<новый_тег>```. Например: ```docker tag my-app:latest myusername/my-app:v1.0```
3. Отправка образа. Затем используйте команду docker push, чтобы отправить образ в репозиторий. Укажите имя репозитория и тег: ```docker push <имя_репозитория>:<тег>```. Например: ```docker push myusername/my-app:v1.0```

## Отправить образ в локальный репозиторий
1. Сначала необходимо протегировать образ ```docker tag slowe/image3:0.1 localhost:5000/image3:0.1```. Таким образом если посмотреть в ```docker image ls``` мы увидим, будто у нас создался второй образ ```slowe/image3:0.1```, но имеющий префикс ```localhost:```.  
**Теги** - это просто указатели на образы. Эта команда тегирует существующий Docker-образ ```slowe/image3:0.1``` новым именем и тегом: ```localhost:5000/image3:0.1```.  
Тегирование образа означает создание новой ссылки на существующий образ. Новый тег ```localhost:5000/image3:0.1``` будет указывать на тот же самый образ, что и ```slowe/image3:0.1```.  
2. Теперь имея localhost tag мы можем использовать команду ```docker push``` чтобы отправить этот образ в **registry**, что работает в нашей системе ```docker push localhost:5000/image3```. Эта команда отправляет Docker-образ с тегом ```localhost:5000/image3:0.1``` в "удалённый реестр" по адресу ```localhost:5000```  


___

docker run -it -p 8443:8443 -v /root/projects/mixer_bot/with_webhooks/native_aiogram/containered/persistant_data:/app/persistant_data mixer_bot > /dev/null &
docker run -d -p 8443:8443 -v /root/projects/mixer_bot/with_webhooks/native_aiogram/containered/persistant_data:/app/persistant_data mixer_bot
docker run -d -p 8443:8443 -v /root/projects/mixer_bot/with_webhooks/native_aiogram/containered/persistant_data:/app/persistant_data --restart=on-failure:5 mixer_bot


## Как запускать Docker без sudo
Наиболее распространенный способ - добавить вашего пользователя в группу docker. Это позволит вам запускать Docker команды без использования sudo.  
```sudo usermod -aG docker $USER```  
После этого выходите из текущей сессии или перезагрузите систему, чтобы изменения вступили в силу.